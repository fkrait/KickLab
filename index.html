<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>KickLab</title>
  <link rel="manifest" href="manifest.json"/>
  <link rel="icon" href="icon-512.png"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet"/>
  <style>
    html, body {
      margin: 0; padding: 0;
      font-family: 'Inter', sans-serif;
      height: 100%;
      background: url('attached_assets/gradient_background.PNG') no-repeat center center fixed;
      background-size: cover;
      color: white;
    }
    body { min-height: 100vh; animation: fadein 1s; }
    @keyframes fadein { from { opacity: 0; } to { opacity: 1; } }
    @keyframes spin { 0% { transform: rotate(0deg);} 100% { transform: rotate(360deg);} }

    #loaderOverlay {
      position: fixed; inset: 0; background: black;
      display: flex; align-items: center; justify-content: center; z-index: 2000;
    }
    .spinner {
      border: 8px solid #fff3; border-top: 8px solid orange;
      border-radius: 50%; width: 80px; height: 80px; animation: spin 1s linear infinite;
    }

    .page-container {
      margin: 7vh auto;
      background: rgba(0,0,0,0.6);
      border-radius: 20px;
      padding: 2.5rem 2rem;
      max-width: 480px;
      box-shadow: 0 8px 32px rgba(31,38,135,0.37);
      backdrop-filter: blur(7px);
      text-align: center;
    }
    h1 { margin-top: 0; color: #ffe600; }
    h2 { margin: 0 0 0.25em; font-size: 1.8rem; }
    p { margin: 0.35em 0; }
    .subtitle { color: #ffd54f; font-size: 1.1rem; margin-bottom: 1.5em; }
    .button-group { display: grid; gap: 0.7rem; }
    .button {
      display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem;
      width: 100%;
      padding: 0.95rem 1.1rem;
      background: linear-gradient(135deg, #ff9800, #ff5722);
      border: none; color: white; font-size: 1.05rem; font-weight: 700;
      border-radius: 12px; cursor: pointer; transition: transform 0.1s, box-shadow 0.2s;
      box-shadow: 0 8px 20px rgba(255, 87, 34, 0.35);
    }
    .button:hover { transform: translateY(-1px); box-shadow: 0 12px 30px rgba(255, 87, 34, 0.45); }
    .button:active { transform: translateY(0); }
    .icon { font-size: 1.25rem; }
    input, select {
      width: 100%; padding: 0.8rem 1rem; border-radius: 10px; border: none; margin: 0.4rem 0 0.9rem;
      background: rgba(255,255,255,0.1); color: white; font-size: 1rem;
    }
    label { display: block; text-align: left; margin: 0.3rem 0 0.2rem; color: #ffd54f; font-weight: 700; }
    .stat-box {
      display: grid; gap: 0.3rem; padding: 1rem; border-radius: 12px;
      background: rgba(255,255,255,0.06); text-align: left; margin-bottom: 1rem;
    }
    .stat-title { font-weight: 800; letter-spacing: 0.02em; }
    .history-item { color: #e0e0e0; }
    .two-col { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 0.5rem; align-items: center; }
    .flex-row { display: flex; gap: 0.5rem; flex-wrap: wrap; justify-content: center; }
    .small-btn {
      padding: 0.6rem 0.9rem; border-radius: 10px; border: 1px solid rgba(255,255,255,0.15);
      background: rgba(255,255,255,0.08); color: white; font-weight: 600; cursor: pointer;
    }
    .small-btn:hover { background: rgba(255,255,255,0.14); }
    .grid-2 { display: grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap: 0.7rem; }
    .badge { display: inline-block; background: #222; padding: 0.3rem 0.55rem; border-radius: 999px; font-size: 0.85rem; color: #ffd54f; border: 1px solid rgba(255,255,255,0.15); }
    .pill { padding: 0.35rem 0.8rem; border-radius: 999px; font-weight: 700; font-size: 0.9rem; }
    .pill.red { background: #b71c1c; }
    .pill.blue { background: #0d47a1; }
    .live-score-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 0.75rem; text-align: left; }
    .score-box {
      background: rgba(255,255,255,0.06); border-radius: 12px; padding: 0.9rem 1rem; position: relative;
      box-shadow: 0 8px 20px rgba(0,0,0,0.35); border: 1px solid rgba(255,255,255,0.08);
    }
    .score-num { font-size: 3rem; font-weight: 800; line-height: 1; }
    .score-label { font-weight: 700; color: #ffd54f; text-transform: uppercase; letter-spacing: 0.05em; }
    .score-actions { display: flex; gap: 0.4rem; flex-wrap: wrap; margin-top: 0.5rem; }
    .score-actions button { flex: 1 1 80px; padding: 0.6rem 0.8rem; }
    .timer { font-size: 2.2rem; font-weight: 800; text-align: center; margin: 0.6rem 0; }
    .round-label { font-size: 1rem; text-align: center; color: #e0e0e0; }
    .rest-info { text-align: center; color: #ffd54f; font-weight: 700; }
    .divider { height: 1px; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent); margin: 1.2rem 0; }
    .section-title { font-size: 1.2rem; margin: 0.8rem 0 0.4rem; color: #ffe082; font-weight: 800; }
    /* Publikvy (ny layout) */
    .audience-view {
      position: fixed; inset: 0; background: #05060a;
      z-index: 3000; display: none; align-items: center; justify-content: center; padding: 1.2rem;
    }
    .audience-board {
      width: min(1200px, 100%);
      background: #0a0b12;
      border-radius: 18px;
      padding: 1rem 1.4rem 1.6rem;
      color: white;
      box-shadow: 0 24px 60px rgba(0,0,0,0.6);
      display: grid;
      gap: 0.8rem;
    }
    .audience-topbar {
      display: flex; align-items: center; justify-content: space-between;
      font-weight: 700; font-size: 1rem; letter-spacing: 0.02em; color: #eee;
    }
    .audience-topbar .logos { display: flex; gap: 0.6rem; align-items: center; opacity: 0.9; }
    .audience-topbar .title { text-transform: uppercase; font-weight: 800; }
    .audience-topbar .match-meta { display: flex; gap: 0.8rem; align-items: center; }
    .scoreboard {
      display: grid;
      grid-template-columns: 1fr 0.8fr 1fr;
      gap: 0.7rem;
      align-items: stretch;
    }
    .side {
      border-radius: 16px;
      padding: 1.2rem;
      position: relative;
      display: grid;
      grid-template-rows: auto auto 1fr auto auto;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.05), 0 18px 40px rgba(0,0,0,0.45);
    }
    .side.blue { background: linear-gradient(180deg, #0d2ca8, #081b5d); }
    .side.red  { background: linear-gradient(180deg, #a61212, #5c0a0a); }
    .side .row { display: flex; align-items: center; justify-content: space-between; gap: 0.6rem; }
    .flag { font-size: 2.2rem; }
    .code { font-size: 1rem; font-weight: 800; letter-spacing: 0.08em; }
    .name { font-size: 1.7rem; font-weight: 800; }
    .score-big { font-size: 8rem; font-weight: 900; text-align: center; margin: 0.2rem 0 0.4rem; line-height: 0.9; }
    .video-icon { font-size: 1.4rem; opacity: 0.9; }
    .gamjeom { font-weight: 800; font-size: 1.1rem; }
    .hits { display: flex; gap: 0.5rem; flex-wrap: wrap; justify-content: center; font-size: 0.95rem; }
    .hit-pill { background: rgba(0,0,0,0.25); padding: 0.45rem 0.75rem; border-radius: 12px; font-weight: 700; }
    .vest-row { display: flex; gap: 0.5rem; justify-content: center; margin-top: 0.4rem; font-weight: 800; }
    .vest { background: rgba(255,255,255,0.12); padding: 0.35rem 0.6rem; border-radius: 10px; }
    .center {
      background: #0b0b0f;
      border-radius: 16px;
      padding: 1rem;
      display: grid;
      grid-template-rows: auto 1fr auto;
      align-items: center;
      justify-items: center;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.05), 0 18px 40px rgba(0,0,0,0.45);
    }
    .center .timeout-label {
      background: #000;
      color: #fff;
      padding: 0.3rem 0.8rem;
      border-radius: 10px;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin-bottom: 0.25rem;
    }
    .center .time-big {
      font-size: 3.6rem;
      font-weight: 900;
      letter-spacing: 0.06em;
    }
    .center .round {
      font-size: 1.3rem;
      font-weight: 800;
      letter-spacing: 0.04em;
      margin-top: 0.3rem;
    }
    .center .info {
      font-size: 0.95rem;
      color: #ccc;
      text-align: center;
      line-height: 1.3;
    }
    .close-audience {
      position: absolute; right: 1rem; top: 1rem; background: rgba(0,0,0,0.4); color: white; border: 1px solid rgba(255,255,255,0.2);
      padding: 0.5rem 0.9rem; border-radius: 10px; cursor: pointer; font-weight: 700;
      z-index: 10;
    }
    .audience-alert {
      background: #f44336; color: #fff; font-weight: 800; padding: 0.7rem 1rem; border-radius: 12px; text-align: center;
      box-shadow: 0 12px 28px rgba(244,67,54,0.45); display:none;
    }
    .audience-winner { font-size: 1.2rem; font-weight: 800; color: #ffe600; text-align: center; }
    .live-tag { font-size: 0.85rem; padding: 0.25rem 0.55rem; border-radius: 8px; background: #b71c1c; color: #fff; font-weight: 800; letter-spacing: 0.08em; }
  </style>
</head>
<body>
  <div id="loaderOverlay">
    <div class="spinner"></div>
  </div>

  <div id="startPage" class="page-container">
    <h1 class="fade-in-title">KickLab</h1>
    <p class="subtitle fade-in-title">Tr√§na din reaktionsf√∂rm√•ga och teknik med stil</p>
    <div class="button-group">
      <button class="button" onclick="showTestPage()"><span class="icon">‚ö°</span> Reaktionstest</button>
      <button class="button" onclick="showKickCounterPage()"><span class="icon">ü¶µ</span> Sparkr√§knare</button>
      <button class="button" onclick="showSparringPage()"><span class="icon">ü•ã</span> Sparring tr√§ning</button>
      <button class="button" onclick="showCompetitionSetupPage()"><span class="icon">üèÜ</span> T√§vlingsl√§ge</button>
      <button class="button" onclick="showLiveScorePage()"><span class="icon">üìä</span> Live sparring score</button>
    </div>
  </div>

  <audio id="clickSound" src="https://upload.wikimedia.org/wikipedia/commons/3/3c/Beep-09.ogg" preload="auto"></audio>

  <script src="main.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const clickSound = document.getElementById('clickSound');
      document.querySelectorAll('button').forEach(btn => {
        btn.addEventListener('click', () => {
          clickSound.currentTime = 0;
          clickSound.play().catch(() => {});
        });
      });
    });
    window.addEventListener('load', () => {
      setTimeout(() => { document.getElementById('loaderOverlay').style.display = 'none'; }, 2000);
    });
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('serviceWorker.js')
        .then(reg => console.log('ServiceWorker registrerad:', reg))
        .catch(err => console.error('ServiceWorker fel:', err));
    }
  </script>

  <!-- Reaction test page -->
  <div id="testPage" class="page-container" style="display:none;">
    <h2>Reaktionstest</h2>
    <p id="command"></p><p id="status"></p><p id="result"></p>
    <div id="history"></div><div id="highscore"></div>
    <div class="button-group">
      <button class="button" onclick="startTest()">Starta test</button>
      <button class="button" onclick="stopTest()">Stoppa test</button>
      <button class="button" onclick="resetStats()">Nollst√§ll statistik</button>
      <button class="button" onclick="showStartPage()">Tillbaka</button>
    </div>
  </div>

  <!-- Kick Counter page -->
  <div id="kickCounterPage" class="page-container" style="display:none;">
    <h2>Sparkr√§knare</h2>
    <label for="testDuration">Varaktighet (sek):</label>
    <input id="testDuration" type="number" value="15" min="1" onchange="updateTestDuration()"/>
    <p id="kickCount">0 sparkar</p><p id="kickTimer">15 sekunder</p>
    <p id="kickStatus">Klicka 'Starta test' f√∂r att b√∂rja</p>
    <div id="kickHistory"></div><div id="kickHighscore"></div>
    <div class="button-group">
      <button class="button" onclick="startKickTest()">Starta test</button>
      <button class="button" onclick="stopKickTest()">Stoppa test</button>
      <button class="button" onclick="resetKickStats()">Nollst√§ll statistik</button>
      <button class="button" onclick="showStartPage()">Tillbaka</button>
    </div>
  </div>

  <!-- Sparring training page -->
  <div id="sparringPage" class="page-container" style="display:none;">
    <h2>Sparring tr√§ning</h2>
    <p id="sparringStatus">Klicka 'Starta' f√∂r att b√∂rja tr√§ningen</p>
    <p id="sparringCommand"></p>
    <div class="button-group">
      <button class="button" onclick="startSparring()">Starta</button>
      <button class="button" onclick="stopSparringTraining()">Stoppa</button>
      <button class="button" onclick="showStartPage()">Tillbaka</button>
    </div>
  </div>

  <!-- Competition setup page -->
  <div id="competitionSetupPage" class="page-container" style="display:none;">
    <h2>T√§vlingsl√§ge</h2>
    <label for="competitionCount">Antal deltagare:</label>
    <input id="competitionCount" type="number" min="1" value="2" onchange="updateCompetitionNameInputs()"/>
    <div id="competitionNames" style="margin-top:1rem;"></div>
    <div class="button-group">
      <button class="button" onclick="startCompetition()">Starta t√§vling</button>
      <button class="button" onclick="showStartPage()">Tillbaka</button>
    </div>
  </div>

  <!-- Competition run/results page -->
  <div id="competitionRunPage" class="page-container" style="display:none;">
    <h2>P√•g√•ende t√§vling</h2>
    <ul id="competitionNamesList" style="list-style:none; padding-left:0; margin-bottom:1rem;"></ul>
    <p id="competitionStatus"></p>
    <div id="competitionResults"></div>
    <div class="button-group">
      <button class="button" onclick="showStartPage()">Tillbaka</button>
    </div>
  </div>

  <!-- Competition round countdown -->
  <div id="competitionRoundPage" class="page-container" style="display:none;">
    <h2>Rond</h2>
    <p id="roundInfo"></p>
    <p id="roundCountdown" style="font-size:3rem; font-weight:800;"></p>
  </div>

  <!-- Countdown overlay for competition -->
  <div id="countdownOverlay" class="overlay">
    <div class="overlay-content">
      <div class="live-tag">T√§vling</div>
      <h3 id="overlayTitle">Startar</h3>
      <div class="countdown-circle" id="countdownNumber">3</div>
      <p id="overlayInfo"></p>
    </div>
  </div>

  <!-- Live sparring score page -->
  <div id="liveScorePage" class="page-container" style="display:none;">
    <div class="two-col" style="align-items:center; margin-bottom:0.5rem;">
      <h2 style="margin:0;">Live sparring score</h2>
      <div class="flex-row">
        <button class="small-btn" onclick="resetLiveScore()">Nollst√§ll</button>
        <button class="small-btn" onclick="toggleAudienceView(true)">√ñppna publikvy</button>
      </div>
    </div>
    <div class="live-score-grid">
      <div class="score-box">
        <div class="score-label">R√ñD</div>
        <div class="score-num" id="redScore">0</div>
        <div class="score-actions">
          <button class="small-btn" onclick="addScore('red', 1)">+1</button>
          <button class="small-btn" onclick="addScore('red', 2)">+2</button>
          <button class="small-btn" onclick="addScore('red', 3)">+3</button>
        </div>
        <div class="score-actions">
          <button class="small-btn" onclick="addPenalty('red')">+1 Gam-jeom</button>
          <button class="small-btn" onclick="removePenalty('red')">-1 Gam-jeom</button>
        </div>
        <div class="flex-row">
          <span class="badge">Head: <span id="redHead">0</span></span>
          <span class="badge">V√§st: <span id="redBody">0</span></span>
          <span class="badge">Slag: <span id="redPunch">0</span></span>
        </div>
      </div>

      <div class="score-box">
        <div class="score-label">BL√Ö</div>
        <div class="score-num" id="blueScore">0</div>
        <div class="score-actions">
          <button class="small-btn" onclick="addScore('blue', 1)">+1</button>
          <button class="small-btn" onclick="addScore('blue', 2)">+2</button>
          <button class="small-btn" onclick="addScore('blue', 3)">+3</button>
        </div>
        <div class="score-actions">
          <button class="small-btn" onclick="addPenalty('blue')">+1 Gam-jeom</button>
          <button class="small-btn" onclick="removePenalty('blue')">-1 Gam-jeom</button>
        </div>
        <div class="flex-row">
          <span class="badge">Head: <span id="blueHead">0</span></span>
          <span class="badge">V√§st: <span id="blueBody">0</span></span>
          <span class="badge">Slag: <span id="bluePunch">0</span></span>
        </div>
      </div>
    </div>

    <div class="divider"></div>
    <div class="grid-2" style="align-items:center;">
      <div>
        <div class="timer" id="liveTimer">02:00</div>
        <div class="round-label">Rond <span id="liveRound">1</span> / <span id="liveTotalRounds">3</span></div>
        <div class="rest-info" id="restStatus"></div>
      </div>
      <div class="score-actions">
        <button class="small-btn" onclick="toggleLiveTimer()"><span id="timerToggleLabel">Starta</span> timer</button>
        <button class="small-btn" onclick="resetLiveTimer()">Nollst√§ll timer</button>
        <button class="small-btn" onclick="startRest()">Starta paus</button>
      </div>
    </div>

    <div class="divider"></div>
    <div class="two-col">
      <div class="stat-box">
        <div class="stat-title">Inst√§llningar</div>
        <label for="matchDuration">Matchtid (sekunder)</label>
        <input id="matchDuration" type="number" min="10" value="120" onchange="setMatchDuration()"/>
        <label for="totalRounds">Antal ronder</label>
        <input id="totalRounds" type="number" min="1" value="3" onchange="setTotalRounds()"/>
        <label for="restSeconds">Paustid (sek)</label>
        <input id="restSeconds" type="number" min="5" value="30" onchange="setRestTime()"/>
        <label for="matchTitle">Matchtitel</label>
        <input id="matchTitle" type="text" placeholder="Final / Tr√§ning" oninput="updateMatchTitle(); updateLiveScoreDisplay();"/>
        <label for="redNameInput">R√∂d deltagare</label>
        <input id="redNameInput" type="text" placeholder="R√∂d" oninput="updateLiveScoreDisplay()"/>
        <label for="redCountryInput">Landskod R√∂d (t.ex. MAR)</label>
        <input id="redCountryInput" type="text" placeholder="MAR" value="MAR" oninput="updateLiveScoreDisplay()"/>
        <label for="redFlagInput">Flagga R√∂d (emoji)</label>
        <input id="redFlagInput" type="text" placeholder="üá≤üá¶" value="üá≤üá¶" oninput="updateLiveScoreDisplay()"/>
        <label for="blueNameInput">Bl√• deltagare</label>
        <input id="blueNameInput" type="text" placeholder="Bl√•" oninput="updateLiveScoreDisplay()"/>
        <label for="blueCountryInput">Landskod Bl√• (t.ex. KOR)</label>
        <input id="blueCountryInput" type="text" placeholder="KOR" value="KOR" oninput="updateLiveScoreDisplay()"/>
        <label for="blueFlagInput">Flagga Bl√• (emoji)</label>
        <input id="blueFlagInput" type="text" placeholder="üá∞üá∑" value="üá∞üá∑" oninput="updateLiveScoreDisplay()"/>
      </div>
      <div class="stat-box">
        <div class="stat-title">Senaste h√§ndelser</div>
        <div id="liveScoreStatus">Inga h√§ndelser √§nnu.</div>
        <div id="roundScore">Ronder: 0 ‚Äì 0</div>
        <div>
          <button class="small-btn" onclick="undoLastAction()">√Öngra senaste</button>
        </div>
      </div>
    </div>
    <div class="divider"></div>
    <div class="flex-row">
      <button class="small-btn" onclick="toggleAudienceView(true)">Visa publikvy</button>
      <button class="small-btn" onclick="showStartPage()">Tillbaka</button>
    </div>
  </div>

  <!-- Audience view (ny layout) -->
  <div id="audienceView" class="audience-view">
    <button class="close-audience" onclick="toggleAudienceView(false)">St√§ng publikvy</button>
    <div class="audience-board">
      <div class="audience-topbar">
        <div class="logos">
          <span>üåê World Taekwondo</span>
          <span>KPNP</span>
        </div>
        <div class="title" id="audienceMatchTitle">Qualification Olympic M -58 kg</div>
        <div class="match-meta">
          <span id="audienceRoundScore">Ronder: 0 ‚Äì 0</span>
          <span class="live-tag">LIVE</span>
        </div>
      </div>

      <div class="scoreboard">
        <!-- Blue side -->
        <div class="side blue">
          <div class="row">
            <span class="flag" id="audienceBlueFlag">üá∞üá∑</span>
            <span class="code" id="audienceBlueCode">KOR</span>
          </div>
          <div class="name" id="audienceBlueName">Kim</div>
          <div class="score-big" id="audienceBlueScore">0</div>
          <div class="row" style="justify-content: space-between;">
            <span class="video-icon">üé•</span>
            <span class="gamjeom">GAM-JEOM: <span id="audienceBluePenalty">0</span></span>
          </div>
          <div class="hits" id="audienceBlueHits">Huvud 0 | V√§st 0 | Slag 0</div>
          <div class="vest-row">
            <span class="vest" id="audienceBlueVestL">74</span>
            <span class="vest" id="audienceBlueVestR">10</span>
          </div>
        </div>

        <!-- Center -->
        <div class="center">
          <div class="timeout-label" id="audienceTimeoutLabel">Time out</div>
          <div class="time-big" id="audienceTimer">02:00</div>
          <div class="round">ROND <span id="audienceRound">1</span></div>
          <div class="info" id="audienceInfo">Red vs Blue</div>
          <div class="audience-alert" id="audienceAlert"></div>
          <div class="audience-winner" id="audienceWinner"></div>
        </div>

        <!-- Red side -->
        <div class="side red">
          <div class="row">
            <span class="flag" id="audienceRedFlag">üá≤üá¶</span>
            <span class="code" id="audienceRedCode">MAR</span>
          </div>
          <div class="name" id="audienceRedName">Hassan</div>
          <div class="score-big" id="audienceRedScore">0</div>
          <div class="row" style="justify-content: space-between;">
            <span class="gamjeom">GAM-JEOM: <span id="audienceRedPenalty">0</span></span>
            <span class="video-icon">üé•</span>
          </div>
          <div class="hits" id="audienceRedHits">Huvud 0 | V√§st 0 | Slag 0</div>
          <div class="vest-row">
            <span class="vest" id="audienceRedVestL">3</span>
            <span class="vest" id="audienceRedVestR">5</span>
          </div>
        </div>
      </div>

      <div class="audience-winner" id="audienceRest">Rest: --</div>
    </div>
  </div>

</body>
</html>
