<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>KickLab</title>
  <link rel="manifest" href="manifest.json"/>
  <link rel="icon" href="icon-512.png"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet"/>
  <style>
    html, body {
      margin: 0; padding: 0;
      font-family: 'Inter', sans-serif;
      height: 100%;
      background: url('attached_assets/gradient_background.PNG') no-repeat center center fixed;
      background-size: cover;
      color: white;
    }
    body { min-height: 100vh; animation: fadein 1s; }
    @keyframes fadein { from { opacity: 0; } to { opacity: 1; } }
    @keyframes spin { 0% { transform: rotate(0deg);} 100% { transform: rotate(360deg);} }

    #loaderOverlay {
      position: fixed; inset: 0; background: black;
      display: flex; align-items: center; justify-content: center; z-index: 2000;
    }
    .spinner {
      border: 8px solid #fff3; border-top: 8px solid orange;
      border-radius: 50%; width: 80px; height: 80px; animation: spin 1s linear infinite;
    }

    .page-container {
      margin: 7vh auto;
      background: rgba(0,0,0,0.6);
      border-radius: 20px;
      padding: 2.5rem 2rem;
      max-width: 480px;
      box-shadow: 0 8px 32px rgba(31,38,135,0.37);
      backdrop-filter: blur(7px);
      text-align: center;
    }
    #startPage { margin-top: 35vh; opacity: 0; animation: fadein 0.6s forwards; animation-delay: 1.5s; }
    .button-group {
      display: flex; flex-direction: column; gap: 1rem; width: 100%; max-width: 440px; margin: 1.5rem auto;
    }
    .button {
      display: flex; align-items: center; justify-content: center; gap: 0.6rem;
      background: linear-gradient(90deg, #ff8008, #ffc837 70%);
      color: #222; border: none; border-radius: 30px;
      padding: 1rem 1.6rem; font-size: 1.05rem; font-weight: bold;
      transition: transform .12s, box-shadow .22s, background .2s;
      cursor: pointer; box-shadow: 0 4px 16px rgba(0,0,0,0.18); width: 100%; outline: none;
    }
    .button:hover { transform: scale(1.03); background: linear-gradient(90deg, #ffc837, #ff8008 70%); box-shadow: 0 0 24px #ff8008a0; }
    .button:active { transform: scale(0.98); background: linear-gradient(90deg, #ff8008, #ffc837 70%); box-shadow: 0 0 18px #ff8008a0; }
    .button .icon { font-size: 1.3rem; line-height: 1; }
    input[type='number'], input[type='text'] {
      width: 100%; padding: 0.6rem; border-radius: 10px; border: none; margin-bottom: 0.8rem; text-align: center; font-size: 1rem;
    }
    label { font-weight: 600; display: block; margin-bottom: 0.35rem; }

    .live-scoreboard {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 1rem; align-items: stretch;
      /* Daedo-liknande layout: tydlig mittpanel och stora sidopo√§ng */
    }
    .side-panel {
      border-radius: 18px; padding: 1.2rem; color: white;
      box-shadow: 0 10px 26px rgba(0,0,0,0.25);
      display: flex; flex-direction: column; justify-content: space-between; min-height: 260px;
    }
    .side-panel.blue { background: linear-gradient(180deg, #163d9b, #0b214f); }
    .side-panel.red { background: linear-gradient(180deg, #b22626, #5c1111); }
    .side-header { display: flex; justify-content: space-between; align-items: center; font-weight: 700; letter-spacing: 0.4px; }
    .side-score { font-size: 4.4rem; font-weight: 800; margin: 0.8rem 0; text-align: center; }
    .panel-label { font-size: 0.95rem; opacity: 0.85; }
    .center-panel {
      background: #0b0b0f; border-radius: 18px; padding: 1rem; color: #ffe600; text-align: center;
      display: grid; gap: 0.6rem; box-shadow: 0 10px 26px rgba(0,0,0,0.3); min-height: 260px;
    }
    .timer-display {
      background: #111; border-radius: 12px; padding: 0.8rem 0.6rem; font-size: 3.2rem; font-weight: 800; letter-spacing: 1px;
      color: #ffe600; border: 2px solid #444; box-shadow: inset 0 0 0 1px #222;
    }
    .meta-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 0.5rem; color: #e0e0e0; }
    .meta-box { background: #1a1a1f; border-radius: 10px; padding: 0.6rem 0.7rem; border: 1px solid #2a2a34; font-weight: 700; }
    .score-actions {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 0.8rem; margin: 1.2rem 0;
    }
    .score-actions .button { flex-direction: column; gap: 0.25rem; padding: 0.9rem; font-size: 1rem; }
    .button-label { font-size: 0.85rem; color: #222; }
    .audience-view {
      position: fixed; inset: 0; background: #050505; color: white; display: none; z-index: 3000; padding: 1.2rem;
    }
    .audience-board {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem; align-items: stretch; height: 100%;
    }
    .audience-panel { border-radius: 18px; padding: 1.5rem; display: flex; flex-direction: column; justify-content: center; text-align: center; box-shadow: 0 12px 32px rgba(0,0,0,0.35); }
    .audience-panel.red { background: linear-gradient(180deg, #b22626, #5c1111); }
    .audience-panel.blue { background: linear-gradient(180deg, #163d9b, #0b214f); }
    .audience-score { font-size: 6rem; font-weight: 800; margin: 0.6rem 0; }
    .audience-meta { background: #0b0b0f; border-radius: 14px; padding: 1rem; color: #ffe600; text-align: center; display: grid; gap: 0.6rem; box-shadow: 0 12px 28px rgba(0,0,0,0.35); }
    .audience-timer { font-size: 3.4rem; font-weight: 800; letter-spacing: 1px; }
    .audience-row { display: flex; justify-content: space-around; gap: 1rem; font-weight: 700; color: #e0e0e0; }
    .audience-rest { font-size: 1.4rem; color: #ffe600; }
    .audience-hits { font-size: 1rem; color: #e0e0e0; }
    .close-audience {
      position: absolute; top: 1rem; right: 1rem; background: #ff8008; color: #222;
      border: none; border-radius: 12px; padding: 0.6rem 1rem; font-weight: 700; cursor: pointer;
      box-shadow: 0 6px 18px rgba(0,0,0,0.3);
    }
    .audience-winner {
      margin-top: 0.6rem;
      font-size: 1.6rem;
      font-weight: 800;
      color: #fff;
    }
    .round-score { font-weight: 700; color: #e0e0e0; }
    @media (max-width: 600px) {
      .page-container { max-width: 95vw; padding: 1rem; }
      .button-group { max-width: 95vw; }
    }
  </style>
</head>
<body>

  <div id="loaderOverlay">
    <div class="spinner"></div>
  </div>

  <div id="startPage" class="page-container">
    <p class="subtitle fade-in-title">Tr√§na din reaktionsf√∂rm√•ga och teknik med stil</p>
    <div class="button-group">
      <button class="button" onclick="showTestPage()"><span class="icon">‚ö°</span> Reaktionstest</button>
      <button class="button" onclick="showKickCounterPage()"><span class="icon">ü¶µ</span> Sparkr√§knare</button>
      <button class="button" onclick="showSparringPage()"><span class="icon">ü•ã</span> Sparring tr√§ning</button>
      <button class="button" onclick="showCompetitionSetupPage()"><span class="icon">üèÜ</span> T√§vlingsl√§ge</button>
      <button class="button" onclick="showLiveScorePage()"><span class="icon">üìä</span> Live sparring score</button>
    </div>
  </div>

  <audio id="clickSound" src="https://www.soundjay.com/button/sounds/button-16.mp3" preload="auto"></audio>

  <script src="main.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const clickSound = document.getElementById('clickSound');
      document.querySelectorAll('button').forEach(btn => {
        btn.addEventListener('click', () => {
          clickSound.currentTime = 0;
          clickSound.play().catch(() => {});
        });
      });
    });
    window.addEventListener('load', () => {
      setTimeout(() => { document.getElementById('loaderOverlay').style.display = 'none'; }, 2000);
    });
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('serviceWorker.js')
        .then(reg => console.log('ServiceWorker registrerad:', reg))
        .catch(err => console.error('ServiceWorker fel:', err));
    }
  </script>

  <!-- Reaction test page -->
  <div id="testPage" class="page-container" style="display:none;">
    <h2>Reaktionstest</h2>
    <p id="command"></p><p id="status"></p><p id="result"></p>
    <div id="history"></div><div id="highscore"></div>
    <div class="button-group">
      <button class="button" onclick="startTest()">Starta test</button>
      <button class="button" onclick="stopTest()">Stoppa test</button>
      <button class="button" onclick="resetStats()">Nollst√§ll statistik</button>
      <button class="button" onclick="showStartPage()">Tillbaka</button>
    </div>
  </div>

  <!-- Kick Counter page -->
  <div id="kickCounterPage" class="page-container" style="display:none;">
    <h2>Sparkr√§knare</h2>
    <label for="testDuration">Varaktighet (sek):</label>
    <input id="testDuration" type="number" value="15" min="1" onchange="updateTestDuration()"/>
    <p id="kickCount">0 sparkar</p><p id="kickTimer">15 sekunder</p>
    <p id="kickStatus">Klicka 'Starta test' f√∂r att b√∂rja</p>
    <div id="kickHistory"></div><div id="kickHighscore"></div>
    <div class="button-group">
      <button class="button" onclick="startKickTest()">Starta test</button>
      <button class="button" onclick="stopKickTest()">Stoppa test</button>
      <button class="button" onclick="resetKickStats()">Nollst√§ll statistik</button>
      <button class="button" onclick="showStartPage()">Tillbaka</button>
    </div>
  </div>

  <!-- Sparring page -->
  <div id="sparringPage" class="page-container" style="display:none;">
    <h2>Sparring tr√§ning</h2>
    <label for="sparringDuration">Varaktighet (sek):</label>
    <input id="sparringDuration" type="number" value="60" min="5"/>
    <p id="sparringStatus">Klicka 'Starta' f√∂r att b√∂rja</p>
    <p id="sparringCommand"></p>
    <div class="button-group">
      <button class="button" onclick="startSparringTraining()">Starta</button>
      <button class="button" onclick="stopSparringTraining()">Stoppa</button>
      <button class="button" onclick="showStartPage()">Tillbaka</button>
    </div>
  </div>

  <!-- Live sparring score (operat√∂rsvy) -->
  <div id="liveScorePage" class="page-container" style="display:none;">
    <h2>Live sparring score</h2>
    <p>Manuellt Daedo-inspirerat system: operat√∂ren registrerar po√§ng och straff, publikvyn speglas separat.</p>
    <div class="score-name-inputs">
      <div>
        <label for="redNameInput">R√∂d</label>
        <input id="redNameInput" type="text" value="R√∂d" oninput="setLiveScoreNames()"/>
      </div>
      <div>
        <label for="blueNameInput">Bl√•</label>
        <input id="blueNameInput" type="text" value="Bl√•" oninput="setLiveScoreNames()"/>
      </div>
      <div>
        <label for="matchNumberInput">Match #</label>
        <input id="matchNumberInput" type="number" value="1" min="1" onchange="updateLiveMeta()"/>
      </div>
      <div>
        <label for="roundNumberInput">Rond</label>
        <input id="roundNumberInput" type="number" value="1" min="1" onchange="updateLiveMeta()"/>
      </div>
      <div>
        <label for="totalRoundsInput">Antal ronder</label>
        <input id="totalRoundsInput" type="number" value="3" min="1" onchange="setTotalRounds()"/>
      </div>
      <div>
        <label for="matchDurationInput">Rondtid (sek)</label>
        <input id="matchDurationInput" type="number" value="120" min="10" onchange="setMatchDuration()"/>
      </div>
    </div>

    <div class="live-scoreboard">
      <div class="side-panel blue">
        <div class="side-header">
          <span class="panel-label">BL√Ö</span>
          <span id="blueNameLabel">Bl√•</span>
        </div>
        <div class="side-score" id="blueScore">0</div>
        <div class="panel-label">GAM-JEOM: <span id="bluePenalty">0</span></div>
      </div>

      <div class="center-panel">
        <div class="meta-row">
          <div class="meta-box">Match <span id="liveMatchNumber">1</span></div>
          <div class="meta-box">Rond <span id="liveRoundNumber">1</span>/<span id="liveTotalRounds">3</span></div>
        </div>
        <div class="timer-display" id="liveTimer">02:00</div>
        <div class="round-score" id="roundScore">Ronder: R√∂d 0 ‚Äì 0 Bl√•</div>
        <p id="restStatus" style="margin:0;color:#e0e0e0;"></p>
        <div class="button-group" style="margin:0;">
          <button class="button" onclick="startLiveTimer()">Start</button>
          <button class="button" onclick="pauseLiveTimer()">Paus</button>
          <button class="button" onclick="endCurrentRound()">Avsluta rond</button>
          <button class="button" onclick="startNextRound()">N√§sta rond</button>
        </div>
        <p class="panel-label" id="liveScoreStatus"></p>
      </div>

      <div class="side-panel red">
        <div class="side-header">
          <span id="redNameLabel">R√∂d</span>
          <span class="panel-label">R√ñD</span>
        </div>
        <div class="side-score" id="redScore">0</div>
        <div class="panel-label" style="text-align:right;">GAM-JEOM: <span id="redPenalty">0</span></div>
      </div>
    </div>

    <div class="score-actions">
      <button class="button" onclick="awardScore('blue', 1)">+1 Bl√•<span class="button-label">Slag/body</span></button>
      <button class="button" onclick="awardScore('blue', 2)">+2 Bl√•<span class="button-label">Kropp</span></button>
      <button class="button" onclick="awardScore('blue', 3)">+3 Bl√•<span class="button-label">Huvud</span></button>
      <button class="button" onclick="awardScore('blue', 4)">+4 Bl√•<span class="button-label">Avancerad</span></button>
      <button class="button" onclick="awardScore('blue', 5)">+5 Bl√•<span class="button-label">Max</span></button>
      <button class="button" onclick="awardPenalty('blue')">Gam-jeom (Bl√•)</button>
      <button class="button" onclick="awardPenalty('red')">Gam-jeom (R√∂d)</button>
      <button class="button" onclick="awardScore('red', 1)">+1 R√∂d<span class="button-label">Slag/body</span></button>
      <button class="button" onclick="awardScore('red', 2)">+2 R√∂d<span class="button-label">Kropp</span></button>
      <button class="button" onclick="awardScore('red', 3)">+3 R√∂d<span class="button-label">Huvud</span></button>
      <button class="button" onclick="awardScore('red', 4)">+4 R√∂d<span class="button-label">Avancerad</span></button>
      <button class="button" onclick="awardScore('red', 5)">+5 R√∂d<span class="button-label">Max</span></button>
    </div>

    <div class="button-group">
      <button class="button" onclick="undoLastAction()">√Öngra senaste</button>
      <button class="button" onclick="resetLiveMatch()">Nollst√§ll match</button>
      <button class="button" onclick="toggleAudienceView(true)">Visa publikvy (samma flik)</button>
      <button class="button" onclick="openAudienceWindow()">√ñppna publikvy i ny flik</button>
      <button class="button" onclick="showStartPage()">Tillbaka</button>
    </div>
  </div>

  <!-- Competition setup -->
  <div id="competitionSetupPage" class="page-container" style="display:none;">
    <h2>T√§vlingsl√§ge ‚Äì inst√§llningar</h2>
    <p>St√§ll in antal deltagare och deras namn.</p>
    <label for="competitionCount">Antal deltagare:</label>
    <input id="competitionCount" type="number" min="1" value="2" onchange="updateCompetitionNameInputs()"/>
    <div id="competitionNames" style="margin-top:1rem;"></div>
    <div class="button-group">
      <button class="button" onclick="confirmCompetitionParticipants()">N√§sta</button>
      <button class="button" onclick="showStartPage()">Tillbaka</button>
    </div>
  </div>

  <div id="competitionRunPage" class="page-container" style="display:none;">
    <h2>T√§vlingsl√§ge</h2>
    <ul id="competitionNamesList" style="list-style:none; padding-left:0; margin-bottom:1rem;"></ul>
    <div class="button-group">
      <button class="button" onclick="startCompetition()">Starta t√§vlingen</button>
      <button class="button" onclick="showCompetitionSetupPage()">Tillbaka</button>
    </div>
    <p id="competitionStatus"></p>
    <div id="competitionResults"></div>
  </div>

  <div id="competitionRoundPage" class="page-container" style="display:none;">
    <h2 id="roundParticipantName" style="font-size:2rem; margin-bottom:2rem;"></h2>
    <div class="button-group">
      <button class="button" style="font-size:1.5rem; padding:1.2rem 2rem;" onclick="beginCompetitionRound()">Starta</button>
      <button class="button" onclick="showCompetitionRunPage()">Tillbaka</button>
    </div>
  </div>

  <div id="countdownOverlay" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;align-items:center;justify-content:center;z-index:1000;background:black;color:orange;font-size:8rem;font-weight:bold;"></div>

  <audio id="cheerSound" src="https://www.soundjay.com/human/applause-01.mp3"></audio>

  <script src="main.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const clickSound = document.getElementById('clickSound');
      document.querySelectorAll('button').forEach(btn => {
        btn.addEventListener('click', () => {
          clickSound.currentTime = 0;
          clickSound.play().catch(() => {});
        });
      });
    });
    window.addEventListener('load', () => {
      setTimeout(() => { document.getElementById('loaderOverlay').style.display = 'none'; }, 2000);
    });
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('serviceWorker.js')
        .then(reg => console.log('ServiceWorker registrerad:', reg))
        .catch(err => console.error('ServiceWorker fel:', err));
    }
  </script>

  <div id="audienceView" class="audience-view">
    <button class="close-audience" onclick="toggleAudienceView(false)">St√§ng publikvy</button>
    <div class="audience-board">
      <div class="audience-panel blue">
        <div id="audienceBlueName">Bl√•</div>
        <div class="audience-score" id="audienceBlueScore">0</div>
        <div>Gam-jeom: <span id="audienceBluePenalty">0</span></div>
      </div>
      <div class="audience-meta">
        <div id="audienceMatchTitle">Match</div>
        <div class="audience-timer" id="audienceTimer">02:00</div>
        <div class="audience-row">
          <span>Rond <span id="audienceRound">1</span></span>
          <span id="audienceInfo"></span>
        </div>
        <div class="audience-row">
          <span id="audienceRoundScore">Ronder: 0 ‚Äì 0</span>
        </div>
        <div class="audience-rest" id="audienceRest">Rest: --</div>
        <div class="audience-winner" id="audienceWinner"></div>
      </div>
      <div class="audience-panel red">
        <div id="audienceRedName">R√∂d</div>
        <div class="audience-score" id="audienceRedScore">0</div>
        <div class="audience-hits" id="audienceRedHits">Huvud 0 | V√§st 0 | Slag 0</div>
        <div>Gam-jeom: <span id="audienceRedPenalty">0</span></div>
      </div>
    </div>
  </div>

</body>
</html>
